# Ping and Watchdog
מטרת המטלה :
PING :
הפקודה ping משמשת לבדיקת החיבור בין 2 מחשבים, בחלק הזה במטלה התבקשנו לכתוב קוד בשם
" ping.py " ,התוכנית תשלח ICMP ECHO REQUEST ל Host , ובעת קבלת ICMP-ECHO-REPLY ,
התוכנית תשלח את ICMP ECHO REQUEST הבא .בעצם שולחת לכתובת IP פינג בעזרת raw socket
בפרוטוקול ICMP , עבור כל פאקטה שהתקבלה, נדפיס את הבי יטים שהתקבלו מה- IP שנשלחה אליה ping ,
sequence number של הפאקטה והזמן בין ה- ICMP ECHO REQUEST לבין ה- ICMP ECHO REPLY.
Watchdog + Better ping:
זה בעצם לכתוב קוד כמו תוכנית הראשונה ששולחת , ping על ידי שימוש ב Socket - Raw
ובפרוטוקול ICMP אבל הפעם נוסי ף watchdog שבמקרה בו אנו לא מקבלים REPLY-ECHO-ICMP תוך
10 שניות מרגע הבקשה התוכנית תיסגר ותדפיס הודעת שגיאה .
תיאור הקוד :
התוכנית כתובה בשפת Python וכוללת תיעוד מלא בתוכה.
המטלה מחולקת ל 2 חלקים , החלק הראשון זה הקוד ' ping.py ' והחלק השני הקודים בשם
' better_ping.py ' ו – ' watchdog.py .'
אופן הרצה :
1 ) נריץ את הפקודה sudo python3 ping.py <IP address> בטרמינל .
2 ) נריץ את הפקודה sudo python3 better_ping.py <IP address> בטרמינ ל .
מערכת ההפעל ה :
22.10LTD Ubuntu

## Ping.py
  הוא מייבא את הספריות הבאות :
os : שהיא מערכת הפעלה לפונקציונליות מערכת ההפעלה.
socket : לתקשורת רשת .
struct : עבור אריזה ופריקה של נתונים בינאריי ם .
sys : לפרמטרים ופונקציות ספציפיות למערכת .
time : לפונקציות הקשורות לזמן .
select : לריבוי קלט/פלט .
  
 ### Function Checksum: 
  פונקציה זו מחשבת את סכום הבדיקה עבור packet ICMP . הוא לוקח packet כקלט ומבצע את חישובי הבדיקה
הדרושים, ומחזיר את הסכום המחושב, בעצם מה שאנחנו רואים כאן זה האלגוריתם שמבצע זאת.
### Receiving_ping function:
  פונקציה זו מקבלת ומעבדת את ICMP echo reply . זה לוקח socket , מזהה תהליך ) pid ( וערך של פסק זמן
( timeout ( כקלט. הוא ממתין ל- echo reply באמצעות select ומקבל את ה- packet . לאחר מכן הוא מחלץ את
ה- ICMP header ,ה- ] 20:28 [ משמש לחילוץ חלק מהרצף של recPacket , המייצג את החבילה )כלומר אומר
שאנו רוצים לחלץ מאינדקס 20 לא כולל 28 (, ואז בודק אם ה- packet היא echo reply חוקית בהתבסס על הסוג
שלה ומזהה ה- packet . ה- received packet וכתובת השולח מוחזרות.

  ### Function Send_ping:
  פונקציה זו שולחת ICMP echo request . היא מקבלת socket וכתובת יעד ) destAddr ( , ה- processes ID
מזהה תהליך ) pid ( ומספר רצף כקלט. הוא יוצר חבילת ICMP עם ה- headrs והנתונים המתאימים, מחשב את
הסכום עם checksum ושולח את ה- packet לכתובת היעד ) destAddr
  
  ### function Ping:
  פונקציה זו היא נקודת הכניסה העיקרית לביצוע ping . זה לוקח כתובת יעד ) destAddr (, ערך פסק זמן ) timeout )
וספירה ) count ( כקלט. זה יוצר socket גולמי לתקשורת ICMP ומטפל בכל שגיאות socket . לאחר מכן הפונקציה
מאתחלת משתנים ונכנסת ללולאה כדי לשלוח ולקבל ICMP echo request ולעבד את ה- replies
  
ולבסוף החלק הראשי שיריץ את התוכנית שלנו , במידה ויש פחות מ 2 ארגומנטים ) ארגומנט אחד זה כבר שם
התוכנית ping.py ( אז זה ידפיס הודעה שתגיד לנו איך לרשום נכון את הפקודה ותצא מהתוכנית.
במידה והכל תקין ניקח את ה IP שהוכנסה ונשים אותה במשתנה Hostname , במידה והוכנס גם עוד ארגומנט
בנוסף ל IP כמו מספר חזרות אז זה יקלוט גם , אם לא פשוט יהיה דפולטיבי וימשיך לרוץ, כמובן אחר כך נר יץ את
פונקציית ping עם הנתונים שלנו.
  ## Better_Ping:
  ### Better_ping function:
  מבצע את פעולת ICMP ping עם הפונקציונליות משופרת, הוא יוצר socket עבור sending and receiving ICMP packets )שליחה וקבלה של חבילות(.
הוא משתמש ב- process ID עבור זיהוי ICMP , לאחר מכן מדפיס את כתובת היעד ומידע עבור גודל
הנתונים, ואז נכנס ללולאה כדי לקבל ולשלוח ICMP packets . שולח ICMP echo request על ידי שימוש
ב- : destination address, process ID, and sequence number , רושם את זמן שליחת החבילה וממתין
לתגובה אם מתקבלת תגובה הוא מחשב את זמן השליחה והלוך ושוב, ואז מדפיס את המידע, אבל אם לא
מתקבלת תגובה בתוך זמן קצוב, הוא מדפיס הודעת פסק זמן ) timeout .)
אם מסופק count היא תוקטן ותשבור את הלולאה , וכאשר count מגיעה לאפס , מספר הרצף
( seq_number ( מוגדל עבור החבילה הבאה.
לבסוף ה- socket נסגר עם סיומה של הלולאה.
  ### function Watchdog (timer):
  פונקצייה זו נועדה עבור ניטור כתובת ip של היעד, הוא מתחבר ל- ip של היעד על port ספציפי ) 3000 ,)
ממתין לתגובה תוך פרק זמן קצוב של 10 שניות, אם לא מתקבלת תגובה , הוא מדפיס הודעת שגיאה ויוצא
מהתוכנית )מפסיק אותה(.
  ### Threads in the main function: 
  ה- threads משומשים בקוד זה על מנת לאפשר ביצוע בו -זמנית של משימות או פעולות מרובות. בפרט
נעשה שימוש בשני טראדים:
1 ( עבור פעולת ה- ping ICMP (ping_thread . )
2 ( עבור הפונקציונליות של ה- watchdog (watchdog_thread . )
המטרה העיקרית של שימוש בטראדים בקוד זה היא לבצע פעולות פינג תוך ניטור בו -זמנית נגישות
לכתובת ה- ip של היעד. ה- ping_thread מטפל בשליחת ICMP ECHO REQUEST וקבלת ICMP echo replies ובו זמנית לנטר את הנגישות של כתובת ה- ip של היעד, מה שמספק לנו בעצם פונקציונליות
וזמן תגובה משופרים.
לאחר התחלת הטראדים, שיטת join נקראת בכל thread וממתינה עד שהם ישלימו את ביצועם לפני
שהתוכנית תצא.
  
  
  
  
  
  
  
  
  
  
  
